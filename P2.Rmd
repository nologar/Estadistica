---
title: "Trabajo Inferencia Estadistica"
output: html_document
date: "2024-11-13"
author:
  - No칠 L칩pez garc칤a
  - Joan Pedro Bruixola
  - Carlos Ribes Garcia
  - Marc Velasco Mateu
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

rm(list=ls())

library(mclust)
library(ggplot2)
```


```{r datos, include=FALSE}
data<-quakes
```

1. Implementa una funci칩n en R para la funci칩n de densidad de probabilidad de la distribuci칩n de mezcla gaussiana. Grafica la funci칩n de densidad de probabilidad de $GM(2,1,5,1,0.3)$. Puedes usar la funci칩n incorporada `dnorm` para la funci칩n de densidad de probabilidad de la distribuci칩n gaussiana.

```{r ej1, echo=FALSE}
#Implementamos la funci칩n de densidad en R
densidadmg <- function(x, mu1, sd1, mu2, sd2, w) {
  # Calculamos la densidad de la mezcla
  densidad <- w * dnorm(x, mean = mu1, sd = sd1) + (1-w) * dnorm(x, mean = mu2, sd = sd2)
  return(densidad)
}

# Establecemos el rango de x
x <- seq(-1, 8, length.out = 500)

#Calculamos la densidad
densidad <- densidadmg(x, 2,1,5,1,0.3)

#Graficamos la densidad
plot(x, densidad, type = "l", col = "blue", lwd = 2,
     main = "Densidad de la Mezcla Gaussiana GM(2, 1, 5, 1, 0.3)",
     xlab = "x", ylab = "Densidad")
```

2.Inicialmente, solo observamos los datos de longitud y asumimos que las ubicaciones de longitud son i.i.d. que siguen un modelo de mezcla gaussiana. Estima los cinco par치metros de la mezcla gaussiana utilizando los 1000 valores observados de longitud. Puedes hacer esto num칠ricamente en R con la funci칩n `optim`. Grafica la mezcla gaussiana ajustada sobre el histograma de los datos de longitud.

Para encontrar un buen punto inicial para los par치metros, simplemente puedes observar el histograma de los datos y tratar de adivinar la ubicaci칩n de las medias $\mu_1$ y $\mu_2$. Una suposici칩n inicial para $w$ puede ser la proporci칩n del tama침o de los dos grupos de datos (o usar $w=0.5$ como suposici칩n inicial). Tambi칠n puedes probar diferentes valores iniciales y reportar los resultados con la menor log-verosimilitud negativa.

Dado que hay muchos par치metros, la optimizaci칩n puede llevar mucho tiempo y es probable que debas aumentar el n칰mero m치ximo de iteraciones del algoritmo; de lo contrario, este terminar치 antes de alcanzar un buen 칩ptimo. Puedes hacerlo con `control = list(maxit = 10000)` en la funci칩n `optim`. Probablemente tambi칠n habr치 muchos *warnings*, principalmente porque los par치metros deben estar restringidos, especialmente $w$. Puedes ignorar los *warnings*.

Antes de empezar a buscar los par치metros, representemos el histograma de la variable longitud para encontrar un buen valor inicial para nuestra b칰squeda de par치metros.

```{r ej2.1, echo=FALSE}
p <- ggplot(data, aes(x=long)) + 
  geom_histogram(color="black", fill="white", breaks=(floor(min(data$long))+0.5):(ceiling(max(data$long))-0.5)) +
  labs(title="Histograma de la variable longitud",x="Longitud", y = "Frecuencia")
p
```

```{r ej2.2, echo=FALSE}
#Creamos la funci칩n de log-verosimilitud negativa
log_verosimilitud <- function(params, x) {
  mu1 <- params[1]
  sd1 <- params[2]
  mu2 <- params[3]
  sd2 <- params[4]
  w <- params[5]

  # Calcular la log-verosimilitud negativa
  densidades <- densidadmg(x, mu1, sd1, mu2, sd2, w)
  return(-sum(log(densidades)))
}

# Buscamos los valores optimizando
resultado <- optim(
  par = c(167,2,182,2,0.3),
  fn = log_verosimilitud,
  x = data$long,
  method = "L-BFGS-B",
  lower = c(-Inf, 0.01, -Inf, 0.01, 0.01),
  upper = c(Inf, Inf, Inf, Inf, 0.99)
)

cat("Estimaci칩n del par치metro mu1:",resultado$par[1],"\n")
cat("Estimaci칩n del par치metro sd1:",resultado$par[2],"\n")
cat("Estimaci칩n del par치metro mu2:",resultado$par[3],"\n")
cat("Estimaci칩n del par치metro sd2:",resultado$par[4],"\n")
cat("Estimaci칩n del par치metro w:",resultado$par[5],"\n")
```
Para comprobar si realmente estos son una buena estimaci칩n, dibujamos la densidad de una mezcla gaussiana de estos par치metros sobre el histograma anterior.

```{r ej2.3, echo=FALSE}
x <- seq(165,189,length.out = 240)
y <- densidadmg(x, resultado$par[1],resultado$par[2],resultado$par[3],resultado$par[4],resultado$par[5])

# Crear el histograma
hist(data$long, breaks = 30, probability = TRUE, col = "gray", xlab = "Longitud", ylab = "Densidad", main = "")

# Superponer la curva de densidad
title <- "Densidad de mezcla gausiana sobre histograma de la longitud"
lines(x, y, col = "blue", lwd = 2, lty = 1)
title(main = title)
```

3.Considera ahora otro modelo en el que las ubicaciones de longitud son independientes y distribuidas de manera gaussiana 
洧녜(洧랞,洧랥2)N(풮,픢 2 ). Ajusta este modelo a los datos observados de longitud.
```{r}

```


4.Calcula los valores de AIC y BIC para el modelo gaussiano simple y el modelo de mezcla gaussiana para los datos de longitud. 쯈u칠 modelo deber칤a seleccionarse?

```{r}
# En el simple empleamos las funciones est치ndar existentes de AIC y BIC

# Emplearemos esta librer칤a para calcular el AIC y el BIC del modelo de mezcla gaussiana.

```

5.Repite el procedimiento de ajuste anterior para los datos de latitud y profundidad, y realiza la selecci칩n de modelos como de costumbre utilizando AIC y BIC. 쯈u칠 modelo deber칤a seleccionarse?
```{r}

```


6.Considera los dos grupos de eventos y calcula el valor medio e intervalos de confianza (95 %) para la media de las longitudes, latitudes y profundidades en los dos grupos (azul y rojo en la Figura 1). 쯈u칠 conclusiones podemos sacar de los intervalos de confianza?
```{r}

```


7.Consideramos ahora la variable n칰mero de estaciones s칤smicas que detectaron el evento (stations). 쯇odemos afirmar que el n칰mero medio de estaciones que detectaron los eventos es significativamente distinto en los dos grupos de terremotos (a nivel 洧띺=0.01풤=0.01 y a nivel 洧띺=0.1풤=0.1)? (Puedes utilizar bootstrap y/o asumir poblaciones normales).

```{r}

```


